<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="sudoku/Sudoku.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <style>
        body { background:#000; color:#666; }
        .cell { float:left; padding:10px; border:1px solid #333;  }
        .container { width:400px; float:left; }
        .hsep { float:left; height:1px; margin-right:15px; }
        .vsep { clear:both; margin-bottom:15px; }
        .clear-fix { float:left; clear:both; }
    </style>
</head>
<body>

</div>
<div class="container">
    <h2>Puzzle:</h2>
    <div id="puzzle-container">

    </div>
</div>

<div class="container">
    <h2>Solved:</h2>
    <div id="solved-container">

    </div>
</div>

<script>



    //createSudokuBoard("puzzle");
    //testGenerate();
    testSolve(4);

    ///
    ///
    ///     TEST METHODS
    ///
    ///




    function testSolve(puzzleId) {
        createSudokuBoard('puzzle');
        var puzzle = getPuzzle(puzzleId)
        populatePuzzle('puzzle', puzzle);

        createSudokuBoard('solved');
        var solved = Sudoku.solve(puzzle);
        populatePuzzle('solved', solved);
    }



    function testGenerate() {
        createSudokuBoard('puzzle');
        var genPuzzle = Sudoku.generate(debugGenerate);
        populatePuzzle('puzzle', genPuzzle);

        createSudokuBoard('solved');
        var solved = Sudoku.solve(genPuzzle, debugSolve);
        populatePuzzle('solved', solved);
    }

    function debugGenerate(arr) {
        populatePuzzle('puzzle', arr);
    }

    function debugSolve(arr) {
        populatePuzzle('solved', arr);
    }




    ///
    ///
    ///     UTILS
    ///
    ///

    var focusedCell;
    function handleCellClick(target) {

        // jquery wrap
        target = $(target);

        // turn off previously selected cell
        if(focusedCell !== undefined) {
            focusedCell.css({'border-color':'#333333'});
        }

        focusedCell = target;
        focusedCell.css({'border-color': '#33ccff'});
    }

    // attach the keyboard listener
    $(document).on('keyup',function(evt) {
        var char = String.fromCharCode(evt.keyCode);
        console.log("code: " + evt.keyCode);
        var int = Number(char);
        if(focusedCell !== undefined && !isNaN(int)) {
            focusedCell.html(int);
            if(int > 0) {
                focusedCell.css({'color': '#ffffff'});
            } else {
                focusedCell.css({'color':'#000000'});
            }
        } else if(focusedCell !== undefined && evt.keyCode === 8) {
            // Delete key
            focusedCell.html(0);
            focusedCell.css({'color':'#000000'});
        }
    });
    /**
     * Testing to get a board.
     * @param id - the board to get
     */
    function getPuzzle(id) {
        /* TEMPLATE
         var arg = [
             0, 0, 0,    0, 0, 0,    0, 0, 0,
             0, 0, 0,    0, 0, 0,    0, 0, 0,
             0, 0, 0,    0, 0, 0,    0, 0, 0,

             0, 0, 0,    0, 0, 0,    0, 0, 0,
             0, 0, 0,    0, 0, 0,    0, 0, 0,
             0, 0, 0,    0, 0, 0,    0, 0, 0,

             0, 0, 0,    0, 0, 0,    0, 0, 0,
             0, 0, 0,    0, 0, 0,    0, 0, 0,
             0, 0, 0,    0, 0, 0,    0, 0, 0
         ];
         */
        var puzzle = [];

        switch(id) {
            case 1:
                puzzle = [
                    5, 3, 0,    0, 7, 0,    0, 0, 0,
                    6, 0, 0,    1, 9, 5,    0, 0, 0,
                    0, 9, 8,    0, 0, 0,    0, 6, 0,

                    8, 0, 0,    0, 6, 0,    0, 0, 3,
                    4, 0, 0,    8, 0, 3,    0, 0, 1,
                    7, 0, 0,    0, 2, 0,    0, 0, 6,

                    0, 6, 0,    0, 0, 0,    2, 8, 0,
                    0, 0, 0,    4, 1, 9,    0, 0, 5,
                    0, 0, 0,    0, 8, 0,    0, 7, 9
                ];
                break;

            case 2:
                puzzle = [
                    0, 0, 2,    1, 0, 3,    0, 0, 0,
                    8, 0, 0,    0, 4, 0,    0, 2, 0,
                    7, 0, 4,    6, 8, 2,    0, 3, 1,

                    6, 0, 9,    0, 0, 0,    1, 0, 0,
                    0, 1, 8,    0, 7, 0,    6, 5, 0,
                    0, 0, 7,    0, 0, 0,    8, 0, 2,

                    1, 8, 0,    7, 3, 4,    2, 0, 9,
                    0, 2, 0,    0, 5, 0,    0, 0, 7,
                    0, 0, 0,    2, 0, 8,    4, 0, 0
                ];
                break;

            /** broke */
            case 3:
                puzzle = [
                    0, 8, 0,    9, 1, 0,    0, 0, 2,
                    0, 0, 0,    0, 4, 3,    3, 1, 6,
                    6, 0, 7,    0, 0, 0,    5, 9, 4,

                    9,7,0,0,3,1,0,0,0,
                    0,0,0,0,0,0,7,0,0,
                    8,0,0,0,0,0,4,0,0,

                    0,0,8,3,0,0,0,4,1,
                    0,0,3,4,9,5,6,0,0,
                    9,0,4,0,0,6,0,0,7
                ]
                break;

            /** Generated */
            case 4:
                puzzle = [
                    0, 0, 0,    0, 0, 0,    9, 2, 3,
                    0, 0, 8,    3, 0, 0,    0, 5, 1,
                    0, 0, 0,    6, 0, 0,    8, 7, 0,

                    0, 9, 1,    4, 7, 0,    5, 0, 0,
                    8, 5, 7,    0, 2, 0,    4, 9, 0,
                    3, 0, 0,    0, 5, 0,    2, 1, 0,

                    0, 2, 0,    0, 6, 4,    0, 0, 7,
                    0, 8, 9,    0, 0, 0,    0, 4, 0,
                    0, 4, 0,    0, 0, 7,    3, 0, 9
                ];
                break;
        }

        return puzzle;
    }

    function createSudokuBoard(containerId) {
        var size = 9;
        var container = $('#' + containerId + "-container");
        var cellIndex = 0;
        // loop rows. every 3 has a v-divider.
        for(var i = 1; i <= size; i++) {

            // loop columns. every 3 has a h-divider
            for(var j = 1; j <= size; j++) {
                var idValue = containerId + "_" + cellIndex;
                var htmlValue = '<div id="' + idValue + '" class="cell" onclick="handleCellClick(this)">0</div>';
                container.append(htmlValue);

                // place the horizontal separator
                if(j % 3 === 0) {
                    container.append('<div class="hsep"></div>');
                }

                cellIndex++;
            }

            // place the vertical separator
            if(i % 3 === 0) {
                container.append('<div class="vsep"></div>');
            } else {
                container.append('<div class="clear-fix"></div>');
            }
        }
    }

    function populatePuzzle(containerId, arr) {
        var len = arr.length;
        for(var i = 0; i < len; i++) {
            var cell = $('#' + containerId + "_" + i);
            cell.text(arr[i]);
            if(arr[i] > 0) {
                cell.css( { 'color':'#33ccff' } );
            }
        }
    }

    function getPopulatedPuzzle(containerId) {
        var size = 81;
        var arr = [];
        for(var i = 0; i < size; i++) {
            var cell = $('#' + containerId + "_" + i);
            arr.push(Number(cell.text()));
        }
        return arr;
    }

    function turnOriginalValues(originalPuzzle, solvedPuzzle) {

    }

</script>
</body>
</html>